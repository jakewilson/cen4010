/*! Meatpocalypse 2016-04-22 */
function pauseFunction(){game.paused=!game.paused,game.paused?tmpPauseTime=+new Date-startTime:pauseTime+=+new Date-startTime-tmpPauseTime}function initTime(){pauseTime=0,startTime=+new Date}var Entity=function(a,b,c,d,e,f){this._game=a,this._name=b,this._health=c||100,this._sprite=null,this._direction="right",this._WALK_FPS=d||5,this._ATTACK_FPS=e||5,this._WALK_SPEED=250,this._currentPlayingAnim=null,this._attacking=!1,this._bulletPool=null,this._damageRate=f||1500,this._nextDamage=0,this._hurting=!1};Entity.prototype.preLoad=function(){this._game.load.atlasJSONHash(this._name,"./assets/spritesheets/"+this._name+".png","./assets/spritesheets/"+this._name+".json")},Entity.prototype.kill=function(){this._sprite.kill(),this._bulletPool&&this._bulletPool.kill()},Entity.prototype.attack=function(a,b){a=a||"attack"+this._direction,b=b||this._ATTACK_FPS,this._attacking||(this._currentPlayingAnim=this._sprite.animations.play(a,b)),this._attacking=!0},Entity.prototype.create=function(a,b,c){c=c||"walkleft1.png",this._sprite=this._game.add.sprite(a,b,this._name,c),this._game.physics.enable(this._sprite),this._sprite.body.collideWorldBounds=!0,this.addAnimation("walkright",["walkright2.png","walkright3.png","walkright4.png"],this._animComplete),this.addAnimation("jumpright",["jumpright1.png"],this._animComplete),this.addAnimation("attackright",["attackright2.png","attackright3.png","attackright4.png"],this._animComplete),this.addAnimation("walkleft",["walkleft2.png","walkleft3.png","walkleft4.png"],this._animComplete),this.addAnimation("jumpleft",["jumpleft1.png"],this._animComplete),this.addAnimation("attackleft",["attackleft2.png","attackleft3.png","attackleft4.png"],this._animComplete)},Entity.prototype.addAnimation=function(a,b,c){this._sprite.animations.add(a,b).onComplete.add(c,this)},Entity.prototype._animComplete=function(){this._sprite.frameName="walk"+this._direction+"1.png",this._currentPlayingAnim=null,this._attacking=!1},Entity.prototype.createBulletPool=function(a,b,c){this._bulletPool=new BulletPool(this._game,a,b,c)},Entity.prototype.setCollision=function(a,b){this._game.physics.arcade.collide(this._sprite,a,b)},Entity.prototype.update=function(){this._sprite.body.velocity.x=0,this._sprite.y+this._sprite.height>=this._game.height&&this.kill(),this._hurting&&(this._sprite.tint=16711680,this._game.time.now>this._nextDamage&&(this._hurting=!1,this._sprite.tint=16777215))},Entity.prototype.getSprite=function(){return this._sprite},Entity.prototype.setBulletPoolCollision=function(a){this._bulletPool&&this._bulletPool.setCollisionWithEntity(a)},Entity.prototype.setBulletPoolCollisionWithLayer=function(a){this._bulletPool&&this._bulletPool.setCollisionWithLayer(a)},Entity.prototype.hurt=function(){this._game.time.now>this._nextDamage&&(this._nextDamage=this._game.time.now+this._damageRate,this._health-=1,this._hurting=!0,0===this._health&&this.kill())},Entity.prototype.move=function(a){"right"===a?(this._direction="right",this._sprite.body.velocity.x=this._WALK_SPEED):"left"===a&&(this._direction="left",this._sprite.body.velocity.x=-this._WALK_SPEED),(null===this._currentPlayingAnim||this._currentPlayingAnim.name.indexOf("walk")>=0)&&(this._currentPlayingAnim=this._sprite.animations.play("walk"+this._direction,this._WALK_FPS))},Entity.prototype.isDead=function(){return!this._sprite.alive};var Enemy=function(a,b,c,d,e,f,g){Entity.call(this,a,b,c,5,5,500),this._ATTACK_RANGE=d,this._WALK_SPEED=e,this._STATES={IDLE:0,PATROL:1,ATTACK:2,CINEMATIC:3},this._state=this._STATES.IDLE,this._direction=g||"left",this._totalDist=0,this._MAX_PATROL_DIST=32*(f||5)};Enemy.prototype=Object.create(Entity.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.preLoad=function(){Entity.prototype.preLoad.call(this)},Enemy.prototype.create=function(a,b,c){c=c||"walk"+this._direction+"1.png",Entity.prototype.create.call(this,a,b,c),this._sprite.body.immovable=!0,this._state=this._STATES.PATROL},Enemy.prototype.update=function(){return this._sprite.visible?(Entity.prototype.update.call(this),!0):!1},Enemy.prototype.setCollisionWithPlayer=function(a){var b=function(b,c){a.hurt()};this._game.physics.arcade.overlap(a.getSprite(),this._sprite,b)},Enemy.prototype._patrol=function(){Math.abs(this._totalDist)>this._MAX_PATROL_DIST&&this.switchDirection(),this.move(this._direction),this._totalDist+=this._sprite.body.deltaX()},Enemy.prototype.facingPlayer=function(a){var b=this._sprite.body.x-a.getSprite().body.x>0?"left":"right";return b===this._direction},Enemy.prototype.playerInRange=function(a,b,c){return b=b||this._ATTACK_RANGE,c=c||a.getSprite().height,Math.abs(this._sprite.x-a.getSprite().x)<=b&&Math.abs(this._sprite.y-a.getSprite().y)<=c},Enemy.prototype.render=function(){(null!==this._sprite&&this._sprite.body.blocked.left||this._sprite.body.blocked.right)&&this.switchDirection()},Enemy.prototype.switchDirection=function(){this._direction="left"===this._direction?"right":"left",this._totalDist=0};var TileSpriteGroup=function(a,b){this._game=a,this._name=b,this._group=null,this._objects=null};TileSpriteGroup.prototype.preLoad=function(){this._game.load.atlasJSONHash(this._name,"./assets/spritesheets/"+this._name+".png","./assets/spritesheets/"+this._name+".json")},TileSpriteGroup.prototype.create=function(a,b,c){b=b||1,c=c||"anim",this._objects=a,this._group=this._game.add.group(),this._group.enableBody=!0,this._group.physicsBodyType=Phaser.Physics.ARCADE;var d=this;this._objects.forEach(function(a,e){var f=d._group.create(a.x,a.y,d._name,b,!0);f.animations.add(c)}),this._group.setAll("body.allowGravity",!1)},TileSpriteGroup.prototype.setCollision=function(a,b){this._game.physics.arcade.overlap(a.getSprite(),this._group,b,null,this)};var Animal=function(a){TileSpriteGroup.call(this,a,"animal"),this._released=!1};Animal.prototype=Object.create(TileSpriteGroup.prototype),Animal.prototype.constructor=Animal,Animal.prototype.setCollision=function(a){var b=function(b,c){c.released||(c.released=!0,c.animations.play("anim",3,!1,!0),a.registerAnimalRescued())};TileSpriteGroup.prototype.setCollision.call(this,a,b)};var Boss=function(a){this._ENEMY_HEALTH=10,Enemy.call(this,a,"boss",this._ENEMY_HEALTH,32,150),this._WALK_SPEED=200,this._STATES.CHARGE=3,this._healthPool=null,this._healthOneY=90,this._healthTwoY=this._healthOneY+20,this._healthX=10300,this._drumstickTextOffset=18,this.inCinematic=!1,this._cinText=""},cinematicText=["It's Good to see you again Gene Gregor, You look as skinny as ever","I see that you've become the leader of the puny vegan resistance.","I, Salem Guido will personally see to the destruction of you and","your vegatable loving friends. MEAT RULES THE WORLD!!!!"],nameText,line=[],wordIndex=0,lineIndex=0,wordDelay=120,lineDelay=400;Boss.prototype=Object.create(Enemy.prototype),Boss.prototype.constructor=Boss,Boss.prototype.preLoad=function(){Entity.prototype.preLoad.call(this),this._game.load.image("drumstick","./assets/spritesheets/drumstick.png")},Boss.prototype.kill=function(){Enemy.prototype.kill.call(this),this._game.state.start("victoryScreen")},Boss.prototype.update=function(a){if(Enemy.prototype.update.call(this)){switch(this._state){case this._STATES.PATROL:this.patrol();break;case this._STATES.ATTACK:this.attack("melee"+this._direction);break;case this._STATES.CINEMATIC:this._playCinematic()}this.inCinematic||(this._state=this.playerInRange(a,null,2*a.getSprite().height)&&this.facingPlayer(a)?this._STATES.ATTACK:this._STATES.PATROL)}},Boss.prototype.patrol=function(){this.move(this._direction),this.attack("range"+this._direction,2);var a="left"===this._direction?0:3*(this._sprite.width/4);this._bulletPool.fireBullet(this._sprite.x+a,this._sprite.y,this._direction)},Boss.prototype.create=function(a,b,c){Enemy.prototype.create.call(this,a,b,c),this.createBulletPool("drumstick",!0,500),this._bulletPool.setFireRate(1500),this.addAnimation("meleeleft",["meleeleft1.png","meleeleft2.png","meleeleft3.png"],this._animComplete),this.addAnimation("rangeleft",["rangeleft1.png","rangeleft2.png"],this._animComplete),this.addAnimation("meleeright",["meleeright1.png","meleeright2.png","meleeright3.png"],this._animComplete),this.addAnimation("rangeright",["rangeright1.png","rangeright2.png"],this._animComplete),this._sprite.body.setSize(47,80,60,15),nameText=this._game.add.text(this._healthX-10,this._healthOneY-25,"Salem Guido",{font:"18px Arial",fill:"#CC0000",align:"left"}),this._createHealthPool(),this._drawHealth(),cinText=game.add.text(this._healthX-600,80,"",{font:"18px Arial",fill:"#19de65",align:"center"})},Boss.prototype._createHealthPool=function(){this._healthPool=this._game.add.group();for(var a=0;a<this._ENEMY_HEALTH;a++)if(5>a){this._healthPool.create(this._healthX+this._drumstickTextOffset*a,this._healthOneY,"drumstick")}else{this._healthPool.create(this._healthX+this._drumstickTextOffset*(a-5),this._healthTwoY,"drumstick")}},Boss.prototype._drawHealth=function(){this._healthPool.callAll("kill");for(var a=0;a<this._health;a++){var b=this._healthPool.getChildAt(a);5>a?b.reset(this._healthX+this._drumstickTextOffset*a,this._healthOneY):b.reset(this._healthX+this._drumstickTextOffset*(a-5),this._healthTwoY)}},Boss.prototype.hurt=function(){this.inCinematic||(Entity.prototype.hurt.call(this),this._drawHealth())},Boss.prototype._playCinematic=function(){this.inCinematic=!0,this._nextLine()},Boss.prototype._nextLine=function(){return lineIndex===cinematicText.length?(this.inCinematic=!1,game.time.events.add(3*Phaser.Timer.SECOND,this._clearCinematic,this),void(this._state=this._STATES.PATROL)):(line=cinematicText[lineIndex].split(" "),wordIndex=0,game.time.events.repeat(wordDelay,line.length,this._nextWord,this),void lineIndex++)},Boss.prototype._nextWord=function(){cinText.text=cinText.text.concat(line[wordIndex]+" "),wordIndex++,wordIndex===line.length&&(cinText.text=cinText.text.concat("\n"),game.time.events.add(lineDelay,this._nextLine,this))},Boss.prototype._clearCinematic=function(){cinText.text=""};var Carrot=function(a){TileSpriteGroup.call(this,a,"carrot")};Carrot.prototype=Object.create(TileSpriteGroup.prototype),Carrot.prototype.constructor=Carrot,Carrot.prototype.setCollision=function(a){var b=function(b,c){c.kill(),a.registerCarrotCollected()};TileSpriteGroup.prototype.setCollision.call(this,a,b)};var NUM_BULLETS=10,BulletPool=function(a,b,c,d){this._game=a,this._gravity=c||!1,this._pool=this._game.add.group(),this._pool.enableBody=!0,this._pool.physicsBodyType=Phaser.Physics.ARCADE,this._pool.createMultiple(NUM_BULLETS,b),this._pool.setAll("outOfCameraBoundsKill",!0),this._pool.setAll("outOfBoundsKill",!0),this._pool.setAll("autoCull",!0),this._pool.setAll("body.allowGravity",this._gravity),this._nextFire=0,this._FIRE_RATE=350,this._BULLET_VELOCITY=d||400};BulletPool.prototype.fireBullet=function(a,b,c){var d=this._pool.getFirstExists(!1);return d&&this._game.time.now>this._nextFire?(this._nextFire=this._game.time.now+this._FIRE_RATE,d.reset(a,b),"right"===c?d.body.velocity.x=this._BULLET_VELOCITY:d.body.velocity.x=-1*this._BULLET_VELOCITY,!0):!1},BulletPool.prototype.setCollisionWithLayer=function(a){var b=function(a,b){a.kill()};this._game.physics.arcade.collide(a,this._pool,b)},BulletPool.prototype.setCollisionWithEntity=function(a){var b=function(b,c){a.hurt(),c.kill()};this._game.physics.arcade.overlap(a.getSprite(),this._pool,b)},BulletPool.prototype.setFireRate=function(a){this._FIRE_RATE=a},BulletPool.prototype.kill=function(){this._pool&&this._pool.callAll("kill")};var RangedEnemy=function(a,b,c){Enemy.call(this,a,"ranger",2,256,100,b,c)};RangedEnemy.prototype=Object.create(Enemy.prototype),RangedEnemy.prototype.constructor=RangedEnemy,RangedEnemy.prototype.preLoad=function(){Enemy.prototype.preLoad.call(this)},RangedEnemy.prototype.update=function(a){if(Enemy.prototype.update.call(this)){switch(this._state){case this._STATES.PATROL:this._MAX_PATROL_DIST>0&&this._patrol();break;case this._STATES.ATTACK:this.attack()}this._state=this.playerInRange(a,null,2*a.getSprite().height)&&this.facingPlayer(a)?this._STATES.ATTACK:this._STATES.PATROL}},RangedEnemy.prototype.create=function(a,b,c){Enemy.prototype.create.call(this,a,b,c),this._sprite.body.setSize(33,67,33,10),this.createBulletPool("meat"),this._bulletPool.setFireRate(1e3)},RangedEnemy.prototype.attack=function(){Enemy.prototype.attack.call(this);var a="left"===this._direction?0:3*(this._sprite.width/4);this._bulletPool.fireBullet(this._sprite.x+a,this._sprite.y+this._sprite.height/4,this._direction)};var MeleeEnemy=function(a,b,c){this._ENEMY_HEALTH=3,Enemy.call(this,a,"butcher",this._ENEMY_HEALTH,32,150,b,c),this._STATES.CHARGE=3,this._VISION=160};MeleeEnemy.prototype=Object.create(Enemy.prototype),MeleeEnemy.prototype.constructor=MeleeEnemy,MeleeEnemy.prototype.update=function(a){if(Enemy.prototype.update.call(this)){switch(this._state){case this._STATES.PATROL:this._WALK_SPEED=150,this._MAX_PATROL_DIST>0&&this._patrol();break;case this._STATES.CHARGE:this._charge();break;case this._STATES.ATTACK:this.attack()}this._state=this._STATES.PATROL,this.facingPlayer(a)&&(this.playerInRange(a,this._ATTACK_RANGE)?this._state=this._STATES.ATTACK:this.playerInRange(a,this._VISION)&&(this._state=this._STATES.CHARGE))}},MeleeEnemy.prototype._charge=function(){this._WALK_SPEED=200,this.move(this._direction)},MeleeEnemy.prototype.create=function(a,b,c){Enemy.prototype.create.call(this,a,b,c),this._sprite.body.setSize(29,59,10,28)};var World=function(a){this._game=a,this._map=null,this.layers=[],this._rangedEnemies=[],this._meleeEnemies=[],this._boss=new Boss(a),this.tofu=new Tofu(a),this.animal=new Animal(a),this.carrot=new Carrot(a),this.trash=new Trash(a),this.enemy=null,this._bossFight=!1};World.prototype.preLoad=function(){this._game.load.tilemap("map","./assets/tilemap/map.json",null,Phaser.Tilemap.TILED_JSON),this._game.load.image("background","./assets/tilemap/background.png"),this.tofu.preLoad(),this.carrot.preLoad(),this.animal.preLoad(),this.trash.preLoad(),this._boss.preLoad(),this._game.load.atlasJSONHash("ranger","./assets/spritesheets/ranger.png","./assets/spritesheets/ranger.json"),this._game.load.image("meat","./assets/spritesheets/meat.png"),this._game.load.atlasJSONHash("butcher","./assets/spritesheets/butcher.png","./assets/spritesheets/butcher.json"),this._game.load.image("tiles","./assets/tiles/tilesheet.png")},World.prototype.create=function(){this._map=game.add.tilemap("map"),this.createLayers(),this.tofu.create(this.layers.Tofu),this.animal.create(this.layers.Animals,3),this.carrot.create(this.layers.Carrots,3),this.trash.create(this.layers.Trash,3),this._map.addTilesetImage("Tilesheet","tiles"),this._map.addTilesetImage("carrotsheet","carrots"),this.setCollisionTiles(),this.layers.First.resizeWorld(),this.createEnemies(),this.enemy=this._rangedEnemies[0]},World.prototype.setCollisionTiles=function(){this._map.setCollisionBetween(18,21),this._map.setCollisionBetween(23,25),this._map.setCollisionBetween(34,35),this._map.setCollisionBetween(39,41),this._map.setCollisionBetween(50,51),this._map.setCollisionBetween(65,69),this._map.setCollision(150)},World.prototype.createLayers=function(){this.layers.First=this._map.createLayer("First"),this.layers.Enemies=this._map.objects.Enemies,this.layers.Tofu=this._map.objects.Tofu,this.layers.Animals=this._map.objects.Animals,this.layers.Carrots=this._map.objects.Carrots,this.layers.Trash=this._map.objects.Trash},World.prototype.update=function(a){this._updateEnemy(this._rangedEnemies,a),this._updateEnemy(this._meleeEnemies,a),this.setCollision(a),a.setBulletPoolCollisionWithLayer(this.layers.First),a.getSprite().body.x>=1e4&&this.startBossBattle(),this._bossFight&&(this._boss.update(a),this._boss.setCollision(this.layers.First),this._boss.setCollisionWithPlayer(a),this._boss.setBulletPoolCollisionWithLayer(this.layers.First),this._boss.setBulletPoolCollision(a),a.setBulletPoolCollision(this._boss))},World.prototype._updateEnemy=function(a,b){var c=this;a.forEach(function(d){d.update(b),d.setCollision(c.layers.First),d.setCollisionWithPlayer(b),d.setBulletPoolCollisionWithLayer(c.layers.First),d.setBulletPoolCollision(b),b.setBulletPoolCollision(d),d.isDead()&&(b.enemyKilled(d),a.splice(a.indexOf(d),1))})},World.prototype.setCollision=function(a){this.tofu.setCollision(a),this.carrot.setCollision(a),this.animal.setCollision(a),this.trash.setCollision(a)},World.prototype.createEnemies=function(){this._createRangedEnemies(),this._createMeleeEnemies()},World.prototype._createRangedEnemies=function(){var a=this;this.layers.Enemies.forEach(function(b){if("Range"===b.name){var c=new RangedEnemy(a._game,b.properties.patrol,b.properties.dir);c.create(b.x,b.y),a._rangedEnemies.push(c)}})},World.prototype._createMeleeEnemies=function(){var a=this;this.layers.Enemies.forEach(function(b){if("Melee"===b.name){var c=new MeleeEnemy(a._game,b.properties.patrol,b.properties.dir);c.create(b.x,b.y),a._meleeEnemies.push(c)}})},World.prototype.render=function(){this._bossFight&&this._boss.render(),this.renderEnemies(this._rangedEnemies)},World.prototype.renderEnemies=function(a){a.forEach(function(a){a.render()})},World.prototype.startBossBattle=function(){if(!this._bossFight){this._bossFight=!0,this._game.camera.unfollow(player.getSprite());var a=this.layers.Enemies[this.layers.Enemies.length-1];this._boss.create(a.x,a.y,"walkleft1.png")}};var Tofu=function(a){TileSpriteGroup.call(this,a,"tofu")};Tofu.prototype=Object.create(TileSpriteGroup.prototype),Tofu.prototype.constructor=Tofu,Tofu.prototype.create=function(a,b){TileSpriteGroup.prototype.create.call(this,a,b,"anim"),this._group.children.forEach(function(a){a.animations.play("anim",5,!0)})},Tofu.prototype.setCollision=function(a){var b=function(b,c){c.kill(),a.heal()};TileSpriteGroup.prototype.setCollision.call(this,a,b)};var Trash=function(a){TileSpriteGroup.call(this,a,"trash")};Trash.prototype=Object.create(TileSpriteGroup.prototype),Trash.prototype.constructor=Trash,Trash.prototype.create=function(a,b){TileSpriteGroup.prototype.create.call(this,a,b,"anim"),this._group.setAll("body.immovable",!0),this._group.children.forEach(function(a){a.animations.play("anim",5,!0),a.body.setSize(20,21,6,43)})},Trash.prototype.setCollision=function(a){var b=function(b,c){a.hurt()};this._game.physics.arcade.collide(a.getSprite(),this._group,b,null,this)};var Player=function(a){this._accountId=parseInt(window.location.search.split("=")[1]),this._STARTING_HEALTH=3,this._MAX_HEALTH=6,Entity.call(this,a,"protagonist",this._STARTING_HEALTH,5,5,1500),this._JUMP_FPS=1.5,this._jumping=!1,this._god=!1,this._cursors=null,this._healthPool=null,this._healthY=10,this._healthX=30,this._tofuTextOffset=18,this._score=0,this._scoreTextOffset=425,this._shotsFired=0,this._carrotsCollected=0,this._animalsRescued=0,this._carrotMultiplier=10,this._animalMultiplier=100,this._enemiesKilled=0,this._enemyMultiplier=20,this._carrotTextOffset=48};Player.prototype=Object.create(Entity.prototype),Player.prototype.constructor=Player;var scoreText,carrotSprite,carrotText;Player.prototype.preLoad=function(){Entity.prototype.preLoad.call(this),this._game.load.image("banana","./assets/spritesheets/banana.png")},Player.prototype.kill=function(){Entity.prototype.kill.call(this),this._game.state.start("deathScreen"),console.log("game over!")},Player.prototype.create=function(a,b){Entity.prototype.create.call(this,a,b,"walkright1.png"),this.createBulletPool("banana"),this._sprite.body.setSize(5,58,30,3),this._sprite.body.gravity.y=300,this._game.camera.follow(this._sprite),this._godButton=this._game.input.keyboard.addKey(Phaser.Keyboard.G),this._godButton.onDown.add(this._godMode,this),this._walkRight=this._game.input.keyboard.addKey(Phaser.Keyboard.D),this._walkLeft=this._game.input.keyboard.addKey(Phaser.Keyboard.A),this._jumpKey=this._game.input.keyboard.addKey(Phaser.Keyboard.W),this._cursors=this._game.input.keyboard.createCursorKeys(),this._attackButton=this._game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);var c={font:"18px Arial",fill:"#00ff00",align:"left"};scoreText=this._game.add.text(this._scoreTextOffset,18,"Score: ",c),scoreText.fixedToCamera=!0,carrotSprite=this._game.add.sprite(18,48,"carrot"),carrotSprite.fixedToCamera=!0,carrotText=this._game.add.text(this._carrotTextOffset,58,"x "+this._carrotsCollected,c),carrotText.fixedToCamera=!0,this._createHealthPool(),this._drawHealth()},Player.prototype.jump=function(){this._sprite.body.onFloor()&&((!this._currentPlayingAnim||this._currentPlayingAnim.name.indexOf("attack")<0)&&(this._currentPlayingAnim=this._sprite.animations.play("jump"+this._direction,this._JUMP_FPS)),this._sprite.body.velocity.y=-400)},Player.prototype.attack=function(){Entity.prototype.attack.call(this);var a="left"===this._direction?0:3*(this._sprite.width/4),b=this._bulletPool.fireBullet(this._sprite.x+a,this._sprite.y+this._sprite.height/4,this._direction);b&&(this._shotsFired+=1)},Player.prototype.update=function(){Entity.prototype.update.call(this),this._attackButton.isDown&&this.attack(),this._cursors.right.isDown||this._walkRight.isDown?this.move("right"):(this._cursors.left.isDown||this._walkLeft.isDown)&&this.move("left"),(this._cursors.up.isDown||this._jumpKey.isDown)&&this.jump(),scoreText.text="Score: "+this.getScore(),carrotText.text="x "+this._carrotsCollected},Player.prototype._godMode=function(){this._god?(this._WALK_SPEED=this._WALK_SPEED/5,this._god=!1):(this._WALK_SPEED=5*this._WALK_SPEED,this._god=!0)},Player.prototype._createHealthPool=function(){this._healthPool=this._game.add.group();for(var a=0;a<this._MAX_HEALTH;a++){this._healthPool.create(this._healthX*a+this._tofuTextOffset,this._healthY,"tofu")}this._healthPool.setAll("fixedToCamera",!0)},Player.prototype._drawHealth=function(){this._healthPool.callAll("kill");for(var a=0;a<this._health;a++){var b=this._healthPool.getChildAt(a);b.reset(this._healthX*a,this._healthY)}},Player.prototype.heal=function(){return this._health+=1,this._drawHealth(),this._health},Player.prototype.hurt=function(){this._god||(Entity.prototype.hurt.call(this),this._drawHealth())},Player.prototype.getCarrotsCollected=function(){return this._carrotsCollected},Player.prototype.getRescuedAnimals=function(){return this._animalsRescued},Player.prototype.registerCarrotCollected=function(){this._carrotsCollected++},Player.prototype.registerAnimalRescued=function(){this._animalsRescued++},Player.prototype.enemyKilled=function(a){this._enemiesKilled++},Player.prototype.getScore=function(){return this._carrotsCollected*this._carrotMultiplier+this._animalsRescued*this._animalMultiplier+this._enemiesKilled*this._enemyMultiplier},Player.prototype.getStats=function(){return{score:this.getScore(),shotsFired:this._shotsFired,carrotsCollected:this._carrotsCollected,animalsRescued:this._animalsRescued,enemiesKilled:this._enemiesKilled,playerid:this._accountId,time:this._game.getElapsedTime()}},Player.prototype.render=function(){};var width=900,height=664,elapsedTime,startTime,victory=0,pauseTime=0,tmpPauseTime=0;playAgain=!1;var game=new Phaser.Game(width,height,Phaser.AUTO,"meatpocalypse"),map,layer,player,timerText,victoryTimeText,loadState={preload:function(){game.load.atlasJSONHash("highScore","./assets/images/mainMenuInverted.png","./assets/images/mainMenuInverted.json"),game.load.atlasJSONHash("quit","./assets/images/mainMenuInverted.png","./assets/images/mainMenuInverted.json"),game.load.atlasJSONHash("play","./assets/images/mainMenuInverted.png","./assets/images/mainMenuInverted.json"),game.load.atlasJSONHash("yesNo","./assets/images/yesNoButtons.png","./assets/images/yesNoButtons.json"),game.load.atlasJSONHash("MainMenu","./assets/images/menuButtons.png","./assets/images/menuButtons.json"),game.load.image("background","./assets/images/MainMenu.png"),game.load.image("death","./assets/images/gameOver.png"),game.load.image("name","./assets/images/Meatpocalypse.png"),game.load.image("instructions","./assets/images/instructions.png"),game.load.image("victory","./assets/images/victory.png")},create:function(){game.physics.startSystem(Phaser.Physics.ARCADE),game.state.start("mainMenu")}},mainMenu={create:function(){function a(){game.state.start("play")}function b(){game.state.start("instructionScreen")}function c(){window.location="/at/highScore.html"}function d(){window.location="/at/index.html"}image=game.add.image(0,0,"background"),console.log(image),quit=game.add.button(675,150,"quit",d,this,"RQuit.png","WQuit.png","RQuit.png"),play_button=game.add.button(50,160,"play",a,this,"RPlayButton.png","WPlay.png","RPlayButton.png"),highScore_button=game.add.button(250,395,"highScore",c,this,"WRHS.png","RWHS.png","WRHS.png"),instruction_button=game.add.button(650,500,"MainMenu",b,this,"instructionsR.png","instructionsW.png","instructionsR.png")}},deathScreen={create:function(){function a(){playAgain=!0,game.state.start("sendStats")}function b(){playAgain=!1,game.state.start("sendStats")}game.add.tileSprite(0,0,1024,1024,"background"),death=game.add.sprite(275,50,"death"),death.scale.set(.5,.5),yes_button=game.add.button(50,160,"yesNo",a,this,"Ryes.png","Wyes.png","Ryes.png"),no_button=game.add.button(675,160,"yesNo",b,this,"Rno.png","Wno.png","Rno.png"),death=game.add.sprite(190,580,"name"),death.scale.set(1,1)}},instructionScreen={create:function(){function a(){game.state.start("mainMenu")}game.add.image(game.world.centerX,game.world.centerY,"instructions").anchor.set(.5),menu_button=game.add.button(750,600,"MainMenu",a,this,"mainMenuR.png","mainMenuW.png","mainMenuR.png")}},victoryScreen={create:function(){function a(){playAgain=!1,game.state.start("sendStats")}function b(){playAgain=!0,game.state.start("sendStats")}image=game.add.image(0,0,"victory"),game.add.button(30,155,"MainMenu",b,this,"playAgainWR.png","playAgainRW.png","playAgainWR.png"),game.add.button(675,165,"MainMenu",a,this,"mainMenuWR.png","mainMenuRW.png","mainMenuWR.png"),victoryTimeText=game.add.text(400,416,"Time: ",{font:"18px Arial",fill:"#ffffff",align:"left"}),victoryTimeText.text="Time: "+elapsedTime,victory=1}},playState={preload:function(){map=new World(game),map.preLoad(),player=new Player(game),player.preLoad()},create:function(){initTime(),bg=game.add.tileSprite(0,0,width,height,"background"),bg.fixedToCamera=!0,map.create();var a={font:"18px Arial",fill:"#ffffff",align:"left"};timerText=game.add.text(800,18,"Time: ",a),timerText.fixedToCamera=!0,pauseKey=game.input.keyboard.addKey(Phaser.Keyboard.ESC),pauseKey.onDown.add(pauseFunction,this),player.create(0,480),game.physics.arcade.gravity.y=500},update:function(){player.setCollision(map.layers.First),player.update(),map.update(player),elapsedTime=((Math.round(+new Date-startTime)-pauseTime)/1e3).toFixed(1),timerText.text="Time: "+elapsedTime},render:function(){map.render()}},sendStats={create:function(){var a=(new XMLHttpRequest,player.getStats());a.victory=victory,a.victory&&(a.score+=500),$.post("/registerStatistics",a),playAgain?game.state.start("play"):location.reload()}};game.state.add("load",loadState,!0),game.state.add("mainMenu",mainMenu),game.state.add("play",playState),game.state.add("deathScreen",deathScreen),game.state.add("victoryScreen",victoryScreen),game.state.add("sendStats",sendStats),game.state.add("instructionScreen",instructionScreen),game.state.add("victoryScreen",victoryScreen),game.getElapsedTime=function(){return elapsedTime};